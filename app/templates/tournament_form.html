{% extends "layout.html" %}
{% block content %}

<style>
  .sk-kbd { font-size: .95rem; color: rgba(0,0,0,.55); }
</style>

{# Ziel für "Zurück/Abbrechen": edit -> Detail, new -> Liste #}
{% set back_url = (url_for('tournaments.tournament_detail', tournament_id=t.id) if mode=='edit'
                   else url_for('tournaments.tournaments_list')) %}

<div class="d-flex justify-content-between align-items-start mb-3">
  <div>
    <h3 class="mb-0">
      {% if mode=='new' %}Neues Turnier{% else %}Turnier bearbeiten{% endif %}
    </h3>
    <div class="sk-kbd mt-1">
      Tastatur: Esc = Zurück · Ctrl+S / Cmd+S = Speichern
    </div>
  </div>
  <div>
    <a class="btn btn-outline-secondary"
       id="btnBack"
       href="{{ back_url }}">
      Zurück
    </a>
  </div>
</div>

<div class="card shadow-sm">
  <div class="card-body">
    <form method="post" class="row g-2" id="tForm">

      <div class="col-md-6">
        <label class="form-label">Turniername *</label>
        <input class="form-control" name="title" required value="{{ t.title }}" autofocus>
      </div>

      <div class="col-md-3">
        <label class="form-label">Datum *</label>
        <input class="form-control" type="date" name="event_date" required value="{{ t.event_date }}">
      </div>

      <div class="col-md-3">
        <label class="form-label">Beginn *</label>
        <input class="form-control" type="time" name="start_time" required value="{{ t.start_time }}">
      </div>

      <div class="col-md-6">
        <label class="form-label">Ort</label>
        <input class="form-control" name="location" value="{{ t.location }}">
      </div>

      <div class="col-md-6">
        <label class="form-label">Veranstalter</label>
        <input class="form-control" name="organizer" value="{{ t.organizer }}">
      </div>

      <div class="col-md-6">
        <label class="form-label">Min. Teilnehmer</label>
        <input class="form-control" type="number" min="0" step="1" name="min_participants" value="{{ t.min_participants }}">
      </div>

      <div class="col-md-6">
        <label class="form-label">Max. Teilnehmer</label>
        <input class="form-control" type="number" min="0" step="1" name="max_participants" value="{{ t.max_participants }}">
        <div class="form-text">0 oder leer = unbegrenzt</div>
      </div>

      <div class="col-12">
        <label class="form-label">Beschreibung</label>
        <textarea class="form-control" name="description" rows="3">{{ t.description }}</textarea>
      </div>

      <div class="col-12 mt-2 d-flex gap-2">
        <button class="btn btn-primary" id="btnSave">Speichern</button>
        <a class="btn btn-outline-secondary" href="{{ back_url }}">Abbrechen</a>
      </div>

    </form>
  </div>
</div>

<script>
(function () {
  document.addEventListener("keydown", function (ev) {
    // Esc = zurück
    if (ev.key === "Escape") {
      ev.preventDefault();
      const b = document.getElementById("btnBack");
      if (b) b.click();
      return;
    }

    // Ctrl+S / Cmd+S = speichern
    const isSave = (ev.key || "").toLowerCase() === "s" && (ev.ctrlKey || ev.metaKey);
    if (isSave) {
      ev.preventDefault();
      const f = document.getElementById("tForm");
      if (f) f.submit();
    }
  });
})();
</script>

{% endblock %}