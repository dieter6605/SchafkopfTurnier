<!-- app/templates/tournament_round_standings.html -->
{% extends "layout.html" %}
{% block content %}

<style>
  .sk-mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

  @media print {
    /* @page bleibt hier sinnvoll, der Rest (nav/.btn/.alert/.no-print) kommt global aus layout */
    @page { margin: 12mm; }

    /* Kopf */
    .sk-print-title {
      margin: 0 0 6mm 0;
      color: #000;
    }
    .sk-print-title .headline {
      font-size: 22pt;
      font-weight: 900;
      margin: 0;
      line-height: 1.05;
    }
    .sk-print-title .meta {
      font-size: 12pt;
      margin: 1mm 0 0 0;
      color: #000;
      font-weight: 600;
    }

    .sk-line {
      break-inside: avoid;
      page-break-inside: avoid;

      display: grid;
      grid-template-columns: 26mm 1fr 22mm 24mm;
      gap: 4mm;

      font-size: 13.5pt;
      line-height: 1.25;
      padding: 2.0mm 0;
      border-bottom: 1.5px solid #000;
      color: #000;
      align-items: baseline;
    }

    .sk-place { white-space: nowrap; font-weight: 900; }
    .sk-name { min-width: 0; }
    .sk-name .muted { color: #000; font-weight: 500; }
    .sk-seat { white-space: nowrap; font-weight: 800; color: #000; }
    .sk-points { white-space: nowrap; text-align: right; font-weight: 900; color: #000; }
    .sk-points .soli { font-weight: 700; }
  }
</style>

<div class="d-flex justify-content-between align-items-start mb-3 flex-wrap gap-2 no-print">
  <div>
    <h3 class="mb-0">{{ t.title }} – Rundenwertung {{ round_no }}</h3>
    <div class="text-muted small">
      Sortierung: Punkte ↓, Soli ↓ (Tie-Breaker), dann Name
      {% if now %}· Stand: {{ now }}{% endif %}
    </div>

    {% if total_tables is defined %}
      <div class="text-muted small mt-1">
        Einzelwerte: <span class="fw-semibold">{{ scores_count }}</span>/{{ expected_scores }}
        {% if scores_count < expected_scores %}
          · Hinweis: Noch nicht alle Tische erfasst.
        {% endif %}
      </div>
    {% endif %}
  </div>

  <div class="d-flex gap-2 flex-wrap">
    <a class="btn btn-outline-secondary"
       href="{{ url_for('tournaments.tournament_round_results_overview', tournament_id=t.id, round_no=round_no) }}">
      Zurück zur Eingabe
    </a>

    <a class="btn btn-outline-secondary"
       href="{{ url_for('tournaments.tournament_round_view', tournament_id=t.id, round_no=round_no) }}">
      Runde
    </a>

    <a class="btn btn-outline-secondary"
       href="{{ url_for('tournaments.tournament_standings_overall', tournament_id=t.id) }}">
      Gesamtwertung
    </a>

    <button class="btn btn-outline-secondary" type="button" onclick="window.print()">Drucken</button>
  </div>
</div>

<div class="card shadow-sm no-print">
  <div class="card-body">
    {% if not rows %}
      <div class="text-muted">Noch keine Ergebnisse für diese Runde vorhanden.</div>
    {% else %}
      <div class="table-responsive">
        <table class="table table-sm align-middle mb-0">
          <thead>
            <tr>
              <th style="width:70px;">Platz</th>
              <th>Nachname</th>
              <th>Vorname</th>
              <th>Wohnort</th>
              <th style="width:110px;">(Nr)</th>
              <th style="width:110px;">Tisch/Sitz</th>
              <th class="text-end" style="width:140px;">Punkte (Soli)</th>
            </tr>
          </thead>
          <tbody>
            {% for r in rows %}
              <tr>
                <td class="sk-mono fw-bold">{{ r.place }}</td>
                <td><strong>{{ r.nachname }}</strong></td>
                <td>{{ r.vorname }}</td>
                <td><span class="text-muted">{{ r.wohnort }}</span></td>
                <td class="sk-mono text-muted">({{ r.player_no }})</td>
                <td class="sk-mono">{{ r.table_no }}/{{ r.seat }}</td>
                <td class="sk-mono fw-bold text-end">{{ r.points }} ({{ r.soli }})</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  </div>
</div>

<div class="print-only">
  <div class="sk-print-title">
    <div class="headline">Rundenwertung – Runde {{ round_no }}</div>
    <div class="meta">{{ t.title }}</div>
    {% if scores_count is defined and expected_scores is defined %}
      <div class="meta">Einzelwerte: {{ scores_count }}/{{ expected_scores }}</div>
    {% endif %}
  </div>

  {% if rows and rows|length > 0 %}
    {% for r in rows %}
      <div class="sk-line">
        <div class="sk-place sk-mono">{{ r.place }}</div>

        <div class="sk-name">
          <strong>{{ r.nachname }}</strong>, {{ r.vorname }}
          <span class="muted">· {{ r.wohnort }}</span>
          <span class="muted sk-mono"> ({{ r.player_no }})</span>
        </div>

        <div class="sk-seat sk-mono">{{ r.table_no }}/{{ r.seat }}</div>

        <div class="sk-points sk-mono">
          {{ r.points }}
          <span class="soli">({{ r.soli }})</span>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="text-muted">Noch keine Ergebnisse.</div>
  {% endif %}
</div>

{% endblock %}