{% extends "layout.html" %}
{% block content %}

<style>
  .sk-mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  .no-print { display: block; }
  .print-only { display: none; }

  @media print {
    nav, .btn, .alert, .no-print { display: none !important; }
    .print-only { display: block !important; }

    @page { margin: 10mm; }
    body { background: #fff !important; }
    .container { max-width: none !important; }

    .sk-print-columns {
      column-count: 2;
      column-gap: 10mm;
      column-fill: auto;
    }

    .sk-print-title h2 { font-size: 14pt; margin: 0; }
    .sk-print-title .meta { font-size: 10pt; margin: 0 0 4mm 0; color: #000; }

    .sk-line {
      break-inside: avoid;
      -webkit-column-break-inside: avoid;

      display: grid;
      grid-template-columns: 18mm 1fr auto; /* Platz | Name | Punkte(Soli) */
      align-items: baseline;
      gap: 4mm;

      font-size: 12.0pt;     /* ✅ größer (vorher 9.5pt) */
      line-height: 1.25;     /* ✅ luftiger */
      padding: 1.6mm 0;      /* ✅ etwas mehr Abstand */
      border-bottom: 1.2px solid #bbb; /* ✅ besserer Kontrast */
      color: #000;
    }

    .sk-place { text-align: right; font-weight: 800; }
    .sk-name  { min-width: 0; }
    .sk-ps    { white-space: nowrap; font-weight: 800; text-align: right; }

    .sk-muted { color: #000; font-weight: 500; }
  }
</style>

<div class="d-flex justify-content-between align-items-start mb-3 flex-wrap gap-2 no-print">
  <div>
    <h3 class="mb-0">{{ t.title }} – Gesamtwertung</h3>
    <div class="text-muted small">
      Sortierung: Punkte ↓, Soli ↓ (Tie-Breaker), dann Name
      {% if now %}· Stand: {{ now }}{% endif %}
    </div>

    {% if participants_count is defined and rounds_count is defined %}
      <div class="text-muted small mt-1">
        Teilnehmer: <span class="fw-semibold">{{ participants_count }}</span> ·
        Runden: <span class="fw-semibold">{{ rounds_count }}</span>
        {% if expected_scores is defined and scores_count is defined %}
          · Einzelwerte: <span class="fw-semibold">{{ scores_count }}</span>/{{ expected_scores }}
          {% if scores_count < expected_scores %}
            · Hinweis: Noch nicht alle Runden/Teilnehmer erfasst.
          {% endif %}
        {% endif %}
      </div>
    {% endif %}
  </div>

  <div class="d-flex gap-2 flex-wrap">
    <a class="btn btn-outline-secondary"
       href="{{ url_for('tournaments.tournament_detail', tournament_id=t.id) }}">
      Turnier
    </a>

    <button class="btn btn-outline-secondary" type="button" onclick="window.print()">Drucken</button>
  </div>
</div>

{# UI-Ansicht #}
<div class="card shadow-sm no-print">
  <div class="card-body">
    {% if not rows %}
      <div class="text-muted">Noch keine Ergebnisse vorhanden.</div>
    {% else %}
      <div class="table-responsive">
        <table class="table table-sm align-middle mb-0">
          <thead>
            <tr>
              <th style="width:70px;">Platz</th>
              <th>Name</th>
              <th style="width:140px;">Punkte (Soli)</th>
            </tr>
          </thead>
          <tbody>
            {% for r in rows %}
              <tr>
                <td class="sk-mono fw-bold text-end">{{ r.place }}</td>
                <td>
                  <strong>{{ r.nachname }}</strong>, {{ r.vorname }}
                  <span class="text-muted">· {{ r.wohnort }}</span>
                  <span class="text-muted sk-mono"> ({{ r.player_no }})</span>
                </td>
                <td class="sk-mono fw-bold text-end">
                  {{ r.points }} ({{ r.soli }})
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  </div>
</div>

{# Druckansicht: 2 Spalten, kompakt #}
<div class="print-only">
  <div class="sk-print-title">
    <h2>{{ t.title }}</h2>
    <div class="meta">
      Gesamtwertung · {{ t.event_date }} · {{ t.start_time }}
      {% if now %} · Stand: {{ now }}{% endif %}
    </div>
    {% if participants_count is defined and rounds_count is defined %}
      <div class="meta">
        Teilnehmer: {{ participants_count }} · Runden: {{ rounds_count }}
        {% if expected_scores is defined and scores_count is defined %}
          · Einzelwerte: {{ scores_count }}/{{ expected_scores }}
        {% endif %}
      </div>
    {% endif %}
  </div>

  {% if rows and rows|length > 0 %}
    <div class="sk-print-columns">
      {% for r in rows %}
        <div class="sk-line">
          <div class="sk-place sk-mono">{{ r.place }}</div>
          <div class="sk-name">
            <strong>{{ r.nachname }}</strong>, {{ r.vorname }}
            <span class="sk-muted">· {{ r.wohnort }}</span>
            <span class="sk-muted"> ({{ r.player_no }})</span>
          </div>
          <div class="sk-ps sk-mono">{{ r.points }} ({{ r.soli }})</div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-muted">Noch keine Ergebnisse.</div>
  {% endif %}
</div>

{% endblock %}